<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
  <title>jsDigest</title>
  <style>
    #results { margin: 0; padding: 0; list-style: none; }
    #results li { font: normal 9pt/1.3 "Courier New"; }
    span.pass { color: #0a0; }
    span.fail { color: #f00; }
  </style>
</head>

<body>
<ul id="results"></ul>

<script type="text/javascript">
Error.prototype.toString = function () {
  return 'Error: ' + this.message;
};

function log(message) {
  document.getElementById('results').innerHTML +=
    '<li>' + String(message) + '&nbsp;</li>';
}

function space() {
  log('');
}

function test(expect, trial, message) {
  var result, passed,
    pass = '<span class="pass">PASS</span>',
    fail = '<span class="fail">FAIL</span>';
  
  try {
    result = 'function' === typeof trial ? trial() : trial;
  } catch (e) {
    result = e;
  }
  
  passed = expect === result ||
    ('string' === typeof expect && expect === typeof result) ||
    ('function' === typeof expect && result instanceof expect);
  
  log((passed ? pass : fail) + ': ' + message + ' {' + result + '}');
}
</script>

<script type="text/javascript" src="../lib/digest.js"></script>
<script type="text/javascript">

log('== Digest ==');
test(true, !!window.Digest, 'Digest is defined');
test('string', window.Digest.Version, 'Digest.Version');

space();

log('== Digest.Encoder ==');
test(true, !!Digest.Encoder, 'Digest.Encoder is defined');
test(Digest.Encoder, Digest.Encoder([0x41]), 'Digest.Encoder(Array)');
test(Digest.Encoder, Digest.Encoder('abcd'), 'Digest.Encoder(String)');
test(Error, function(){ return Digest.Encoder(['a', 'b']); }, 'Invalid Array elements');
space();
test('abcd', Digest.Encoder('abcd').string(), 'Digest.Encoder#string');
test('abcd', Digest.Encoder(Digest.Encoder('abcd')).string(), 'Digest.Encoder#string w/ cloning');

space();
log('== UTF-8 Encoding ==');
test('\x24',          Digest.Encoder('\u0024').unicode(), 'UTF-8 encode U+0024');
test('\xC2\xA2',      Digest.Encoder('\u00A2').unicode(), 'UTF-8 encode U+00A2');
test('\xE2\x82\xAC',  Digest.Encoder('\u20AC').unicode(), 'UTF-8 encode U+20AC');

space();
log('== RFC-3548 Encoding ==');
test('AB',        Digest.Encoder('AB').string(),  'Encoder#string');
test('4142',      Digest.Encoder('AB').base16(),  'Encoder#base16');
test('IFBA====',  Digest.Encoder('AB').base32(),  'Encoder#base32');
test('QUI=',      Digest.Encoder('AB').base64(),  'Encoder#base64');

</script>

</body>
</html>
