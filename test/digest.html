<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
  <title>jsDigest</title>
  <style>
    #results { margin: 0; padding: 0; list-style: none; }
    #results li { font: normal 9pt/1.3 "Courier New"; }
    span.pass { color: #0a0; }
    span.fail { color: #f00; }
  </style>
</head>

<body>
<ul id="results"></ul>

<script type="text/javascript">
Error.prototype.toString = function () {
  return 'Error: ' + this.message;
};

function log(message) {
  document.getElementById('results').innerHTML +=
    '<li>' + String(message) + '&nbsp;</li>';
}

function space() {
  log('');
}

function test(expect, trial, message) {
  var result, passed,
    pass = '<span class="pass">PASS</span>',
    fail = '<span class="fail">FAIL</span>';
  
  try {
    result = 'function' === typeof trial ? trial() : trial;
  } catch (e) {
    result = e;
  }
  
  passed = expect === result ||
    ('string' === typeof expect && expect === typeof result) ||
    ('function' === typeof expect && result instanceof expect);
  
  log((passed ? pass : fail) + ': ' + message + ' {' + result + '}');
}
</script>

<script type="text/javascript" src="../lib/digest.js"></script>
<script type="text/javascript">

log('== Digest ==');
test(true, !!window.Digest, 'Digest is defined');
test('string', window.Digest.Version, 'Digest.Version');

space();

log('== Digest.Encoder ==');
test(true, !!Digest.Encoder, 'Digest.Encoder is defined');
test(Digest.Encoder, Digest.Encoder([0x41]), 'Digest.Encoder(Array)');
test(Digest.Encoder, Digest.Encoder('abcd'), 'Digest.Encoder(String)');
test(Error, function(){ return Digest.Encoder(['a', 'b']); }, 'Invalid Array elements');
space();
test('abcd', Digest.Encoder('abcd').string(), 'Digest.Encoder#string');
test('abcd', Digest.Encoder(Digest.Encoder('abcd')).string(), 'Digest.Encoder#string w/ cloning');

space();
log('== UTF-8 Encoding ==');
test('\x24',          Digest.Encoder('\u0024').unicode(), 'UTF-8 encode U+0024');
test('\xC2\xA2',      Digest.Encoder('\u00A2').unicode(), 'UTF-8 encode U+00A2');
test('\xE2\x82\xAC',  Digest.Encoder('\u20AC').unicode(), 'UTF-8 encode U+20AC');

space();
log('== RFC-3548 Encoding ==');
test('AB',        Digest.Encoder('AB').string(),  'Encoder#string');
test('4142',      Digest.Encoder('AB').base16(),  'Encoder#base16');
test('IFBA====',  Digest.Encoder('AB').base32(),  'Encoder#base32');
test('QUI=',      Digest.Encoder('AB').base64(),  'Encoder#base64');

space();
log('== Hash: MD ==');
test(true, !!Digest.md4, 'Digest.md4 is defined');
test(true, !!Digest.md5, 'Digest.md5 is defined');
space();
test('a448017aaf21d8525fc10ae87aa6729d', Digest.md4('abc').hex(), 'Digest.md4("abc")');
test('900150983cd24fb0d6963f7d28e17f72', Digest.md5('abc').hex(), 'Digest.md5("abc")');
test('043f8582f241db351ce627e153e7f0e4', Digest.md4('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789').hex(), 'Digest.md4("A..Za..z0..9")');
test('d174ab98d277d9f5a5611c2c9f419d9f', Digest.md5('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789').hex(), 'Digest.md5("A..Za..z0..9")');

space();
log('== Hash: SHA ==');
test(true, !!Digest.sha1, 'Digest.sha1 is defined');
test(true, !!Digest.sha224, 'Digest.sha224 is defined');
test(true, !!Digest.sha256, 'Digest.sha256 is defined');
test(true, !!Digest.sha384, 'Digest.sha384 is defined');
test(true, !!Digest.sha512, 'Digest.sha512 is defined');
space();
test('A9993E364706816ABA3E25717850C26C9CD0D89D', Digest.sha1('abc').base16(), 'Digest.sha1("abc")');
test('84983E441C3BD26EBAAE4AA1F95129E5E54670F1', Digest.sha1('abcdbcdecdefdefgefghfghighijhijkijkljklmklmnlmnomnopnopq').base16(), 'Digest.sha1("abcd..nopq")');
space();
test('23097D223405D8228642A477BDA255B32AADBCE4BDA0B3F7E36C9DA7',          Digest.sha224('abc').base16(), 'Digest.sha224("abc")');
test('BA7816BF8F01CFEA414140DE5DAE2223B00361A396177A9CB410FF61F20015AD',  Digest.sha256('abc').base16(), 'Digest.sha256("abc")');
test('75388B16512776CC5DBA5DA1FD890150B0C6455CB4F58B1952522525',          Digest.sha224('abcdbcdecdefdefgefghfghighijhijkijkljklmklmnlmnomnopnopq').base16(), 'Digest.sha224("abcd..nopq")');
test('248D6A61D20638B8E5C026930C3E6039A33CE45964FF2167F6ECEDD419DB06C1',  Digest.sha256('abcdbcdecdefdefgefghfghighijhijkijkljklmklmnlmnomnopnopq').base16(), 'Digest.sha256("abcd..nopq")');
space();
test('CB00753F45A35E8BB5A03D699AC65007272C32AB0EDED1631A8B605A43FF5BED8086072BA1E7CC2358BAECA134C825A7',                                  Digest.sha384('abc').base16(), 'Digest.sha384("abc")');
test('DDAF35A193617ABACC417349AE20413112E6FA4E89A97EA20A9EEEE64B55D39A2192992A274FC1A836BA3C23A3FEEBBD454D4423643CE80E2A9AC94FA54CA49F',  Digest.sha512('abc').base16(), 'Digest.sha512("abc")');
test('09330C33F71147E83D192FC782CD1B4753111B173B3B05D22FA08086E3B0F712FCC7C71A557E2DB966C3E9FA91746039',                                  Digest.sha384('abcdefghbcdefghicdefghijdefghijkefghijklfghijklmghijklmnhijklmnoijklmnopjklmnopqklmnopqrlmnopqrsmnopqrstnopqrstu').base16(), 'Digest.sha224("abcdefgh..nopqrstu")');
test('8E959B75DAE313DA8CF4F72814FC143F8F7779C6EB9F7FA17299AEADB6889018501D289E4900F7E4331B99DEC4B5433AC7D329EEB6DD26545E96E55B874BE909',  Digest.sha512('abcdefghbcdefghicdefghijdefghijkefghijklfghijklmghijklmnhijklmnoijklmnopjklmnopqklmnopqrlmnopqrsmnopqrstnopqrstu').base16(), 'Digest.sha256("abcdefgh..nopqrstu")');

var hmac_1_txt  = 'Hi There';
var hmac_1_key1 = '\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b';
var hmac_1_key2 = '\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b';
var hmac_7_txt1 = 'Test Using Larger Than Block-Size Key and Larger Than One Block-Size Data';
var hmac_7_key1 = '\xaa\xaa\xaa\xaa\xaa\xaa\xaa\xaa\xaa\xaa';
var hmac_7_txt2 = 'This is a test using a larger than block-size key and a larger than block-size data. The key needs to be hashed before being used by the HMAC algorithm.';
var hmac_7_key2 = '\xaa' + hmac_7_key1 + hmac_7_key1 + hmac_7_key1 + hmac_7_key1 + hmac_7_key1;

hmac_7_key1 = hmac_7_key1 + hmac_7_key1;
hmac_7_key1 = hmac_7_key1 + hmac_7_key1;
hmac_7_key1 = hmac_7_key1 + hmac_7_key1;
hmac_7_key2 += hmac_7_key1;

space();
log('== HMAC ==');
test('9294727a3638bb1c13f48ef8158bfc9d',          Digest.hmac(Digest.md5,  hmac_1_key1, hmac_1_txt).hex(),  'RFC 2202 - Test 1 - HMAC-MD5');
test('6f630fad67cda0ee1fb1f562db3aa53e',          Digest.hmac(Digest.md5,  hmac_7_key1, hmac_7_txt1).hex(), 'RFC 2202 - Test 7 - HMAC-MD5');
test('b617318655057264e28bc0b6fb378c8ef146be00',  Digest.hmac(Digest.sha1, hmac_1_key2, hmac_1_txt).hex(),  'RFC 2202 - Test 1 - HMAC-SHA-1');
test('e8e99d0f45237d786d6bbaa7965c7808bbff1a91',  Digest.hmac(Digest.sha1, hmac_7_key1, hmac_7_txt1).hex(), 'RFC 2202 - Test 7 - HMAC-SHA-1');
space();
test('896fb1128abbdf196832107cd49df33f47b4b1169912ba4f53684b22',          Digest.hmac(Digest.sha224, hmac_1_key2, hmac_1_txt).hex(),  'RFC 4231 - Test 1 - HMAC-SHA-224');
test('3a854166ac5d9f023f54d517d0b39dbd946770db9c2b95c9f6f565d1',          Digest.hmac(Digest.sha224, hmac_7_key2, hmac_7_txt2).hex(), 'RFC 4231 - Test 7 - HMAC-SHA-224');
test('b0344c61d8db38535ca8afceaf0bf12b881dc200c9833da726e9376c2e32cff7',  Digest.hmac(Digest.sha256, hmac_1_key2, hmac_1_txt).hex(),  'RFC 4231 - Test 1 - HMAC-SHA-256');
test('9b09ffa71b942fcb27635fbcd5b0e944bfdc63644f0713938a7f51535c3a35e2',  Digest.hmac(Digest.sha256, hmac_7_key2, hmac_7_txt2).hex(), 'RFC 4231 - Test 7 - HMAC-SHA-256');
space();
test('afd03944d84895626b0825f4ab46907f15f9dadbe4101ec682aa034c7cebc59cfaea9ea9076ede7f4af152e8b2fa9cb6',                                  Digest.hmac(Digest.sha384, hmac_1_key2, hmac_1_txt).hex(),  'RFC 4231 - Test 1 - HMAC-SHA-384');
test('6617178e941f020d351e2f254e8fd32c602420feb0b8fb9adccebb82461e99c5a678cc31e799176d3860e6110c46523e',                                  Digest.hmac(Digest.sha384, hmac_7_key2, hmac_7_txt2).hex(), 'RFC 4231 - Test 7 - HMAC-SHA-384');
test('87aa7cdea5ef619d4ff0b4241a1d6cb02379f4e2ce4ec2787ad0b30545e17cdedaa833b7d6b8a702038b274eaea3f4e4be9d914eeb61f1702e696c203a126854',  Digest.hmac(Digest.sha512, hmac_1_key2, hmac_1_txt).hex(),  'RFC 4231 - Test 1 - HMAC-SHA-512');
test('e37b6a775dc87dbaa4dfa9f96e5e3ffddebd71f8867289865df5a32d20cdc944b6022cac3c4982b10d5eeb55c3e4de15134676fb6de0446065c97440fa8c6a58',  Digest.hmac(Digest.sha512, hmac_7_key2, hmac_7_txt2).hex(), 'RFC 4231 - Test 7 - HMAC-SHA-512');

</script>

</body>
</html>
